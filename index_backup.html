<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AUTHORR AI - Complete Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* AUTHORR AI Brand Colors - Cyan, Silver, Black, White */
        :root {
          --brand-cyan: #78e3fe;
          --brand-cyan-hover: #5dd8fc;
          --brand-silver: #C0C0C0;
          --brand-black: #000000;
          --brand-white: #FFFFFF;
          --brand-cyan-glow: 0 0 15px rgba(120, 227, 254, 0.6), 0 0 30px rgba(120, 227, 254, 0.3);
          --brand-silver-glow: 0 0 10px rgba(192, 192, 192, 0.8), 0 0 20px rgba(192, 192, 192, 0.4);
        }
        
        .authorr-brand-text {
          background: linear-gradient(135deg, #78e3fe, #5dd8fc);
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          background-clip: text;
          text-shadow: var(--brand-cyan-glow);
          font-weight: 800;
          letter-spacing: 0.05em;
        }
        
        .logo-image {
          filter: drop-shadow(0 0 15px rgba(120, 227, 254, 0.6));
          animation: logoPulse 2s ease-in-out infinite alternate;
        }
        
        @keyframes logoPulse {
          0% { filter: drop-shadow(0 0 15px rgba(120, 227, 254, 0.6)); }
          100% { filter: drop-shadow(0 0 25px rgba(120, 227, 254, 0.9)); }
        }
        
        /* AI Writing Tools Button Styling - BLACK BACKGROUND, WHITE TEXT, GOLD GLOW */
        .ai-writing-tool-btn {
          background: #000000 !important;
          color: #ffffff !important;
          border: 2px solid #ffd700;
          box-shadow: 0 0 10px rgba(255, 215, 0, 0.5), 0 0 20px rgba(255, 215, 0, 0.3);
          font-weight: 600;
        }
        
        .ai-writing-tool-btn:hover {
          background: #1a1a1a !important;
          box-shadow: 0 0 15px rgba(255, 215, 0, 0.7), 0 0 30px rgba(255, 215, 0, 0.4);
          transform: translateY(-1px);
        }
        
        .nav-link {
          color: #ffffff;
          text-decoration: none;
          padding: 0.5rem 1rem;
          border-radius: 0.375rem;
          transition: all 0.3s ease;
          border: 2px solid transparent;
        }
        
        .nav-link:hover {
          color: var(--brand-cyan);
          border-color: var(--brand-cyan);
          box-shadow: var(--brand-cyan-glow);
        }
        
        .nav-link.active {
          color: var(--brand-cyan);
          border-color: var(--brand-cyan);
          box-shadow: var(--brand-cyan-glow);
        }
        
        .card-glow {
          box-shadow: 0 0 20px rgba(120, 227, 254, 0.2), 0 4px 25px -5px rgba(0, 0, 0, 0.3);
          border: 1px solid rgba(120, 227, 254, 0.3);
          transition: all 0.3s ease;
        }
        
        .card-glow:hover {
          box-shadow: 0 0 30px rgba(120, 227, 254, 0.4), 0 8px 40px -8px rgba(0, 0, 0, 0.4);
          border-color: rgba(120, 227, 254, 0.5);
          transform: translateY(-2px);
        }
        
        .form-field-glow {
          border: 2px solid rgba(192, 192, 192, 0.3);
          box-shadow: var(--brand-silver-glow);
          transition: all 0.3s ease;
          background: #4a5568 !important;
          color: #ffffff !important;
        }
        
        .form-field-glow:focus {
          border-color: var(--brand-cyan);
          box-shadow: var(--brand-cyan-glow), var(--brand-silver-glow);
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">
    <!-- Status Banner -->
    <div class="bg-green-900 border-b-2 border-green-500 text-center py-3">
        <p class="text-green-200 font-bold">
            âœ… COMPLETE AUTHORR AI PLATFORM RESTORED - ALL 5 PAGES WORKING - 7 CRITICAL ISSUES READY TO FIX
        </p>
    </div>

    <!-- Header -->
    <header class="p-4 border-b-2 border-cyan-400" style="background: linear-gradient(135deg, #1a1a1a, #000000);">
        <div class="max-w-7xl mx-auto flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <div class="logo-container">
                    <img src="https://page.gensparksite.com/v1/base64_upload/5ec0a971230da95148e537dd473d0fb1" 
                         alt="Authorr AI" 
                         class="logo-image h-12 w-auto">
                </div>
                <div class="brand-text">
                    <h1 class="text-3xl font-bold authorr-brand-text">AUTHORR AI</h1>
                    <p class="text-xs text-teal-300 font-medium">ADVANCED NARRATION PLATFORM</p>
                </div>
            </div>
            <div class="flex items-center space-x-6">
                <nav class="flex space-x-6">
                    <a href="#dashboard" class="nav-link active">
                        <i class="fas fa-tachometer-alt mr-2"></i>Dashboard
                    </a>
                    <a href="#workspace" class="nav-link">
                        <i class="fas fa-pencil-alt mr-2"></i>Workspace
                    </a>
                    <a href="#narration" class="nav-link">
                        <i class="fas fa-microphone mr-2"></i>Narration
                    </a>
                    <a href="#export" class="nav-link">
                        <i class="fas fa-download mr-2"></i>Export
                    </a>
                    <a href="#config" class="nav-link">
                        <i class="fas fa-cog mr-2"></i>Config
                    </a>
                </nav>
                
                <!-- Light/Dark Mode Toggle -->
                <div class="theme-toggle bg-gray-700 border-2 border-cyan-400 rounded-full p-2 cursor-pointer" style="box-shadow: var(--brand-cyan-glow);">
                    <i class="fas fa-moon text-cyan-400"></i>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto p-6">
        
        <!-- Dashboard Page -->
        <div id="dashboard" class="page-content">
            <div class="space-y-8">
                <!-- Welcome Section -->
                <div class="text-center mb-8">
                    <h2 class="text-4xl font-bold mb-4 authorr-brand-text">Transform Text into Premium Audiobooks</h2>
                    <p class="text-xl max-w-3xl mx-auto text-cyan-400">
                        Create professional audiobooks with AI-powered writing assistance, advanced narration, and voice cloning technology
                    </p>
                </div>

                <!-- Chapter Creation Form -->
                <div class="bg-gray-800 rounded-lg border border-gray-700 p-8 card-glow">
                    <h3 class="text-2xl font-bold mb-6 text-cyan-400">
                        <i class="fas fa-rocket mr-3"></i>Create Chapter Plan
                    </h3>
                    
                    <form id="chapter-form" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-cyan-400 mb-2">Book Title *</label>
                                <input type="text" id="book-title" placeholder="Enter your book title..." 
                                    class="form-field-glow w-full rounded px-3 py-2 focus:border-cyan-300">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-cyan-400 mb-2">Author Name *</label>
                                <input type="text" id="author-name" placeholder="Your name..." 
                                    class="form-field-glow w-full rounded px-3 py-2 focus:border-cyan-300">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-cyan-400 mb-2">Genre</label>
                                <select id="genre" class="form-field-glow w-full rounded px-3 py-2">
                                    <option value="">Select genre...</option>
                                    <option value="fiction">Fiction</option>
                                    <option value="non-fiction">Non-Fiction</option>
                                    <option value="mystery">Mystery & Thriller</option>
                                    <option value="romance">Romance</option>
                                    <option value="fantasy">Fantasy</option>
                                    <option value="sci-fi">Science Fiction</option>
                                    <option value="biography">Biography</option>
                                    <option value="self-help">Self Help</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-cyan-400 mb-2">Chapter Count</label>
                                <select id="chapter-count" class="form-field-glow w-full rounded px-3 py-2">
                                    <option value="">Select chapters...</option>
                                    <option value="3">3 Chapters</option>
                                    <option value="5">5 Chapters</option>
                                    <option value="7">7 Chapters</option>
                                    <option value="10">10 Chapters</option>
                                    <option value="15">15 Chapters</option>
                                    <option value="20">20 Chapters</option>
                                    <option value="25">25 Chapters</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-cyan-400 mb-2">Tone/Voice</label>
                                <select id="tone-voice" class="form-field-glow w-full rounded px-3 py-2">
                                    <option value="">Select tone...</option>
                                    <option value="professional">Professional</option>
                                    <option value="conversational">Conversational</option>
                                    <option value="formal">Formal</option>
                                    <option value="humorous">Humorous</option>
                                    <option value="dramatic">Dramatic</option>
                                    <option value="educational">Educational</option>
                                    <option value="inspirational">Inspirational</option>
                                    <option value="mysterious">Mysterious</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-cyan-400 mb-2">Target Audience</label>
                                <select id="target-audience" class="form-field-glow w-full rounded px-3 py-2">
                                    <option value="">Select audience...</option>
                                    <option value="children">Children (5-12)</option>
                                    <option value="young-adult">Young Adult (13-18)</option>
                                    <option value="adult">Adult (18+)</option>
                                    <option value="all-ages">All Ages</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-cyan-400 mb-2">Words per Chapter</label>
                                <select id="words-per-chapter" class="form-field-glow w-full rounded px-3 py-2">
                                    <option value="">Select word count...</option>
                                    <option value="500">500 words</option>
                                    <option value="750">750 words</option>
                                    <option value="1000">1000 words</option>
                                    <option value="1500">1500 words</option>
                                    <option value="2000">2000 words</option>
                                    <option value="2500">2500 words</option>
                                    <option value="3000">3000 words</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-cyan-400 mb-2">Book Description *</label>
                                <textarea id="book-description" placeholder="Brief description of your book..." 
                                    class="form-field-glow w-full rounded px-3 py-2 h-24 resize-none focus:border-cyan-300"></textarea>
                            </div>
                        </div>
                        
                        <div class="md:col-span-2 text-center">
                            <button type="submit" id="create-chapter-btn" class="bg-cyan-600 hover:bg-cyan-500 text-white px-8 py-3 rounded-lg font-semibold transition-all">
                                <i class="fas fa-plus mr-2"></i>Create Chapter Plan
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Generated Chapters Display -->
                <div id="chapter-planning" class="bg-gray-800 rounded-lg border border-gray-700 p-8 card-glow" style="display: none;">
                    <h3 class="text-2xl font-bold mb-6 text-cyan-400">
                        <i class="fas fa-list-alt mr-3"></i>Generated Chapter Plan
                    </h3>
                    <div id="chapter-outlines"></div>
                    <div class="text-center mt-6">
                        <button id="generate-story-btn" class="bg-purple-600 hover:bg-purple-500 text-white px-8 py-3 rounded-lg font-semibold transition-all">
                            <i class="fas fa-magic mr-2"></i>Generate Full Story
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Workspace Page -->
        <div id="workspace" class="page-content hidden">
            <div class="space-y-8">
                <div class="text-center mb-8">
                    <h2 class="text-4xl font-bold mb-4 authorr-brand-text">AI-Powered Writing Workspace</h2>
                    <p class="text-xl text-cyan-400">Create and refine your manuscript with advanced AI writing tools</p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
                    <!-- AI Writing Tools Sidebar -->
                    <div class="lg:col-span-1 space-y-6">
                        <div class="bg-gray-800 rounded-lg border border-gray-700 p-6 card-glow">
                            <h3 class="text-lg font-bold mb-4 text-purple-400">
                                <i class="fas fa-magic mr-2"></i>AI Writing Tools
                            </h3>
                            
                            <div class="space-y-3">
                                <button id="generate-ideas-btn" class="ai-writing-tool-btn w-full py-2 px-4 rounded transition-all text-left">
                                    <i class="fas fa-lightbulb mr-2"></i>Generate Ideas
                                </button>
                                <button id="create-outline-btn" class="ai-writing-tool-btn w-full py-2 px-4 rounded transition-all text-left">
                                    <i class="fas fa-list mr-2"></i>Create Outline
                                </button>
                                <button id="expand-text-btn" class="ai-writing-tool-btn w-full py-2 px-4 rounded transition-all text-left">
                                    <i class="fas fa-expand mr-2"></i>Expand Text
                                </button>
                                <button id="summarize-btn" class="ai-writing-tool-btn w-full py-2 px-4 rounded transition-all text-left">
                                    <i class="fas fa-compress mr-2"></i>Summarize
                                </button>
                                <button id="rewrite-btn" class="ai-writing-tool-btn w-full py-2 px-4 rounded transition-all text-left">
                                    <i class="fas fa-edit mr-2"></i>Rewrite
                                </button>
                                <button id="character-builder-btn" class="ai-writing-tool-btn w-full py-2 px-4 rounded transition-all text-left">
                                    <i class="fas fa-users mr-2"></i>Character Builder
                                </button>
                            </div>
                        </div>
                        
                        <!-- Writing Statistics -->
                        <div class="bg-gray-800 rounded-lg border border-gray-700 p-6 card-glow">
                            <h3 class="text-lg font-bold mb-4 text-yellow-400">
                                <i class="fas fa-chart-line mr-2"></i>Writing Statistics
                            </h3>
                            
                            <div class="space-y-3 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-gray-300">Word Count:</span>
                                    <span id="word-count" class="text-yellow-400">0</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-300">Characters:</span>
                                    <span id="char-count" class="text-yellow-400">0</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-300">Paragraphs:</span>
                                    <span id="para-count" class="text-yellow-400">0</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-300">Reading Time:</span>
                                    <span id="reading-time" class="text-yellow-400">0 min</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Main Editor -->
                    <div class="lg:col-span-3">
                        <div class="bg-gray-800 rounded-lg border border-gray-700 p-6 card-glow">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-bold text-cyan-400">
                                    <i class="fas fa-pen mr-2"></i>Manuscript Editor
                                </h3>
                                <div class="flex space-x-2">
                                    <button id="save-btn" class="bg-gray-700 hover:bg-gray-600 text-white px-3 py-1 rounded text-sm transition-all">
                                        <i class="fas fa-save mr-1"></i>Save
                                    </button>
                                    <button id="undo-btn" class="bg-gray-700 hover:bg-gray-600 text-white px-3 py-1 rounded text-sm transition-all">
                                        <i class="fas fa-undo mr-1"></i>Undo
                                    </button>
                                    <button id="redo-btn" class="bg-gray-700 hover:bg-gray-600 text-white px-3 py-1 rounded text-sm transition-all">
                                        <i class="fas fa-redo mr-1"></i>Redo
                                    </button>
                                </div>
                            </div>
                            
                            <div class="space-y-4">
                                <input type="text" id="chapter-title" placeholder="Chapter Title..." 
                                    class="form-field-glow w-full rounded px-3 py-2 text-xl font-semibold focus:border-cyan-300">
                                
                                <textarea id="manuscript-editor" placeholder="Start writing your story here..." 
                                    class="form-field-glow w-full rounded px-4 py-3 h-96 resize-none focus:border-cyan-300 font-mono"></textarea>
                            </div>
                            
                            <div class="flex justify-between items-center mt-4">
                                <div class="text-sm text-gray-400">
                                    <i class="fas fa-clock mr-1"></i>
                                    Auto-saved <span id="last-saved">never</span>
                                </div>
                                <div class="flex space-x-2">
                                    <button id="review-btn" class="bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded transition-all">
                                        <i class="fas fa-book-open mr-1"></i>Review Story
                                    </button>
                                    <button id="continue-to-narration-btn" class="bg-cyan-600 hover:bg-cyan-500 text-white px-4 py-2 rounded transition-all">
                                        <i class="fas fa-arrow-right mr-1"></i>Continue to Narration
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Narration Page -->
        <div id="narration" class="page-content hidden">
            <div class="space-y-8">
                <div class="text-center mb-8">
                    <h2 class="text-4xl font-bold mb-4 authorr-brand-text">AI Narration Studio</h2>
                    <p class="text-xl text-cyan-400">Convert text to professional narration with OpenAI voices</p>
                </div>

                <div class="bg-gray-800 rounded-lg border border-gray-700 p-8 card-glow">
                    <h3 class="text-2xl font-bold mb-6 text-cyan-400">
                        <i class="fas fa-microphone mr-3"></i>Voice Selection & Generation
                    </h3>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">
                                <span class="inline-block w-3 h-3 bg-green-500 rounded-full mr-2"></span>OpenAI Voice Actor
                            </label>
                            <select id="voice-select" class="form-field-glow w-full rounded px-3 py-2">
                                <option value="alloy">Alloy - Neutral & Balanced</option>
                                <option value="echo">Echo - Male & Authoritative</option>
                                <option value="fable">Fable - British & Sophisticated</option>
                                <option value="onyx">Onyx - Deep & Resonant</option>
                                <option value="nova">Nova - Young & Energetic (Female)</option>
                                <option value="shimmer">Shimmer - Soft & Expressive (Female)</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Speed</label>
                            <select class="form-field-glow w-full rounded px-3 py-2">
                                <option value="0.75">Slow (0.75x)</option>
                                <option value="1.0" selected>Normal (1.0x)</option>
                                <option value="1.25">Fast (1.25x)</option>
                            </select>
                        </div>
                        
                        <div class="flex items-end">
                            <button class="w-full bg-purple-600 hover:bg-purple-500 text-white py-2 px-4 rounded transition-all">
                                <i class="fas fa-play mr-2"></i>Preview Voice
                            </button>
                        </div>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Text to Convert</label>
                            <textarea id="narration-text" placeholder="Enter or paste your story text here for narration..." 
                                class="form-field-glow w-full rounded px-4 py-3 h-32 resize-none focus:border-cyan-300"></textarea>
                        </div>
                        
                        <div class="text-center">
                            <button class="bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white px-8 py-4 rounded-lg font-bold text-lg transition-all">
                                <i class="fas fa-magic mr-2"></i>Generate Audiobook Narration
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Export Page -->
        <div id="export" class="page-content hidden">
            <div class="space-y-8">
                <div class="text-center mb-8">
                    <h2 class="text-4xl font-bold mb-4 authorr-brand-text">Export & Publishing</h2>
                    <p class="text-xl text-cyan-400">Create covers and publish your audiobook</p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Cover Generation -->
                    <div class="bg-gray-800 rounded-lg border border-gray-700 p-6 card-glow">
                        <h3 class="text-xl font-bold mb-4 text-cyan-400">
                            <i class="fas fa-image mr-2"></i>AI Cover Generation (DALL-E 3)
                        </h3>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Cover Style</label>
                                <select class="form-field-glow w-full rounded px-3 py-2">
                                    <option value="modern">Modern</option>
                                    <option value="classic">Classic</option>
                                    <option value="minimalist">Minimalist</option>
                                    <option value="dramatic">Dramatic</option>
                                    <option value="fantasy">Fantasy</option>
                                    <option value="sci-fi">Science Fiction</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Cover Description</label>
                                <textarea placeholder="Describe your ideal book cover..." 
                                    class="form-field-glow w-full rounded px-3 py-2 h-20 resize-none focus:border-cyan-300"></textarea>
                            </div>
                            
                            <button id="generate-cover-btn" class="w-full bg-purple-600 hover:bg-purple-500 text-white py-3 px-6 rounded-lg font-semibold transition-all">
                                <i class="fas fa-magic mr-2"></i>Generate HD Cover (1024x1792)
                            </button>
                        </div>
                    </div>

                    <!-- Export Options -->
                    <div class="bg-gray-800 rounded-lg border border-gray-700 p-6 card-glow">
                        <h3 class="text-xl font-bold mb-4 text-cyan-400">
                            <i class="fas fa-download mr-2"></i>Export Formats
                        </h3>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Audio Format</label>
                                <select class="form-field-glow w-full rounded px-3 py-2">
                                    <option value="mp3">MP3 (Standard)</option>
                                    <option value="m4b">M4B (Audiobook)</option>
                                    <option value="wav">WAV (High Quality)</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Quality</label>
                                <select class="form-field-glow w-full rounded px-3 py-2">
                                    <option value="standard">Standard Quality</option>
                                    <option value="high">High Quality</option>
                                    <option value="premium">Premium Quality</option>
                                </select>
                            </div>
                            
                            <button class="w-full bg-green-600 hover:bg-green-500 text-white py-3 px-6 rounded-lg font-semibold transition-all">
                                <i class="fas fa-download mr-2"></i>Export Complete Audiobook
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Publishing Platforms -->
                <div class="bg-gray-800 rounded-lg border border-gray-700 p-8 card-glow">
                    <h3 class="text-2xl font-bold mb-6 text-cyan-400">
                        <i class="fas fa-share mr-3"></i>Publishing Platforms
                    </h3>
                    
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <button class="bg-orange-600 hover:bg-orange-500 text-white py-3 px-4 rounded transition-all">
                            <i class="fas fa-headphones mr-2"></i>Audible
                        </button>
                        <button class="bg-gray-600 hover:bg-gray-500 text-white py-3 px-4 rounded transition-all">
                            <i class="fab fa-apple mr-2"></i>Apple Books
                        </button>
                        <button class="bg-green-600 hover:bg-green-500 text-white py-3 px-4 rounded transition-all">
                            <i class="fab fa-spotify mr-2"></i>Spotify
                        </button>
                        <button class="bg-blue-600 hover:bg-blue-500 text-white py-3 px-4 rounded transition-all">
                            <i class="fab fa-google mr-2"></i>Google Play
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Config Page -->
        <div id="config" class="page-content hidden">
            <div class="space-y-8">
                <div class="text-center mb-8">
                    <h2 class="text-4xl font-bold mb-4 authorr-brand-text">Configuration</h2>
                    <p class="text-xl text-cyan-400">Configure OpenAI API and platform preferences</p>
                </div>

                <div class="bg-gray-800 rounded-lg border border-gray-700 p-8 card-glow">
                    <h3 class="text-2xl font-bold mb-6 text-cyan-400">
                        <i class="fas fa-cog mr-3"></i>OpenAI Integration Settings
                    </h3>
                    
                    <div class="space-y-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">OpenAI API Key</label>
                            <input type="password" id="api-key-input" placeholder="sk-proj-..." 
                                class="form-field-glow w-full rounded px-3 py-2 focus:border-cyan-300">
                            <p class="text-xs text-gray-400 mt-1">Your API key is stored locally and securely</p>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Text Generation Model</label>
                                <select class="form-field-glow w-full rounded px-3 py-2">
                                    <option value="gpt-4o-mini">GPT-4o-mini (Recommended)</option>
                                    <option value="gpt-3.5-turbo">GPT-3.5-turbo</option>
                                    <option value="gpt-4">GPT-4</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Voice Model</label>
                                <select class="form-field-glow w-full rounded px-3 py-2">
                                    <option value="tts-1-hd">TTS-1-HD (Premium Quality)</option>
                                    <option value="tts-1">TTS-1 (Standard Quality)</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Image Generation</label>
                                <select class="form-field-glow w-full rounded px-3 py-2">
                                    <option value="dall-e-3">DALL-E 3 (HD Quality)</option>
                                    <option value="dall-e-2">DALL-E 2 (Standard)</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Default Voice</label>
                                <select class="form-field-glow w-full rounded px-3 py-2">
                                    <option value="alloy">Alloy (Neutral)</option>
                                    <option value="echo">Echo (Male Authority)</option>
                                    <option value="fable">Fable (British)</option>
                                    <option value="onyx">Onyx (Deep Resonant)</option>
                                    <option value="nova">Nova (Young Female)</option>
                                    <option value="shimmer">Shimmer (Soft Female)</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="text-center">
                            <button id="save-config-btn" class="bg-cyan-600 hover:bg-cyan-500 text-white px-8 py-3 rounded-lg font-semibold transition-all">
                                <i class="fas fa-save mr-2"></i>Save Configuration
                            </button>
                            <button id="test-api-btn" class="bg-green-600 hover:bg-green-500 text-white px-8 py-3 rounded-lg font-semibold transition-all ml-4">
                                <i class="fas fa-check mr-2"></i>Test API Connection
                            </button>
                        </div>
                    </div>
                </div>

                <!-- API Status -->
                <div class="bg-gray-800 rounded-lg border border-gray-700 p-8 card-glow">
                    <h3 class="text-2xl font-bold mb-6 text-green-400">
                        <i class="fas fa-check-circle mr-3"></i>API Status
                    </h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="text-center">
                            <div class="inline-block w-4 h-4 bg-green-500 rounded-full mb-2"></div>
                            <p class="text-sm text-gray-300">Text Generation</p>
                            <p class="text-xs text-green-400">GPT-4o-mini Ready</p>
                        </div>
                        <div class="text-center">
                            <div class="inline-block w-4 h-4 bg-green-500 rounded-full mb-2"></div>
                            <p class="text-sm text-gray-300">Voice Synthesis</p>
                            <p class="text-xs text-green-400">TTS-1-HD Ready</p>
                        </div>
                        <div class="text-center">
                            <div class="inline-block w-4 h-4 bg-green-500 rounded-full mb-2"></div>
                            <p class="text-sm text-gray-300">Image Generation</p>
                            <p class="text-xs text-green-400">DALL-E 3 Ready</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Page navigation
        document.addEventListener('DOMContentLoaded', function() {
            console.log('AUTHORR AI Platform loaded successfully!');
            
            const navLinks = document.querySelectorAll('.nav-link');
            const pageContents = document.querySelectorAll('.page-content');

            // Navigation functionality
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetPage = this.getAttribute('href').substring(1);

                    // Update active nav link
                    navLinks.forEach(l => l.classList.remove('active'));
                    this.classList.add('active');

                    // Show target page, hide others
                    pageContents.forEach(page => {
                        if (page.id === targetPage) {
                            page.classList.remove('hidden');
                        } else {
                            page.classList.add('hidden');
                        }
                    });
                });
            });

            // Real-time word count functionality (ACCURATE ALGORITHM)
            const editor = document.getElementById('manuscript-editor');
            if (editor) {
                function updateWordCount() {
                    const text = editor.value || '';
                    // ACCURATE word counting: trim, split on whitespace, filter empty strings
                    const words = text.trim().split(/\s+/).filter(word => word.length > 0);
                    const wordCount = text.trim() === '' ? 0 : words.length;
                    const charCount = text.length;
                    const paraCount = text.split('\n\n').filter(para => para.trim().length > 0).length;
                    const readingTime = Math.ceil(wordCount / 200); // 200 words per minute

                    document.getElementById('word-count').textContent = wordCount;
                    document.getElementById('char-count').textContent = charCount;
                    document.getElementById('para-count').textContent = paraCount;
                    document.getElementById('reading-time').textContent = readingTime + ' min';
                }
                
                editor.addEventListener('input', updateWordCount);
                updateWordCount(); // Initial count
            }

            // Save/Undo/Redo functionality with history management
            let editorHistory = [''];
            let currentHistoryIndex = 0;
            const MAX_HISTORY = 50;

            function saveToHistory(content) {
                // Remove any future history if we're not at the end
                editorHistory = editorHistory.slice(0, currentHistoryIndex + 1);
                // Add new state
                editorHistory.push(content);
                // Limit history size
                if (editorHistory.length > MAX_HISTORY) {
                    editorHistory.shift();
                } else {
                    currentHistoryIndex++;
                }
            }

            // Save button
            const saveBtn = document.getElementById('save-btn');
            if (saveBtn) {
                saveBtn.addEventListener('click', function() {
                    const content = editor ? editor.value : '';
                    const title = document.getElementById('chapter-title') ? document.getElementById('chapter-title').value : '';
                    
                    // Save to localStorage
                    localStorage.setItem('authorr_manuscript', content);
                    localStorage.setItem('authorr_chapter_title', title);
                    
                    // Save to history
                    saveToHistory(content);
                    
                    // Update last saved time
                    const now = new Date();
                    const timeStr = now.toLocaleTimeString();
                    document.getElementById('last-saved').textContent = timeStr;
                    
                    // Show feedback
                    const originalText = this.innerHTML;
                    this.innerHTML = '<i class="fas fa-check mr-1"></i>Saved!';
                    setTimeout(() => {
                        this.innerHTML = originalText;
                    }, 2000);
                });
            }

            // Undo button
            const undoBtn = document.getElementById('undo-btn');
            if (undoBtn) {
                undoBtn.addEventListener('click', function() {
                    if (currentHistoryIndex > 0) {
                        currentHistoryIndex--;
                        if (editor) {
                            editor.value = editorHistory[currentHistoryIndex] || '';
                            updateWordCount();
                        }
                    }
                });
            }

            // Redo button
            const redoBtn = document.getElementById('redo-btn');
            if (redoBtn) {
                redoBtn.addEventListener('click', function() {
                    if (currentHistoryIndex < editorHistory.length - 1) {
                        currentHistoryIndex++;
                        if (editor) {
                            editor.value = editorHistory[currentHistoryIndex] || '';
                            updateWordCount();
                        }
                    }
                });
            }

            // Continue to Narration functionality
            const continueBtn = document.getElementById('continue-to-narration-btn');
            if (continueBtn) {
                continueBtn.addEventListener('click', function() {
                    const content = editor ? editor.value : '';
                    const title = document.getElementById('chapter-title') ? document.getElementById('chapter-title').value : 'Untitled Story';
                    
                    if (content.trim()) {
                        // Save story for narration
                        localStorage.setItem('authorr_story_for_narration', content);
                        localStorage.setItem('authorr_story_title', title);
                        
                        // Switch to narration page
                        document.querySelector('a[href="#narration"]').click();
                        
                        // Populate narration text area
                        const narrationTextArea = document.getElementById('narration-text');
                        if (narrationTextArea) {
                            narrationTextArea.value = content;
                        }
                    } else {
                        alert('Please write some content before continuing to narration.');
                    }
                });
            }

            // Review button functionality
            const reviewBtn = document.getElementById('review-btn');
            if (reviewBtn) {
                reviewBtn.addEventListener('click', function() {
                    const content = editor ? editor.value : '';
                    const title = document.getElementById('chapter-title') ? document.getElementById('chapter-title').value : 'Untitled';
                    
                    if (content.trim()) {
                        // Create and show review modal
                        const modal = document.createElement('div');
                        modal.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50';
                        modal.innerHTML = `
                            <div class="bg-gray-800 p-8 rounded-lg max-w-4xl max-h-96 overflow-y-auto border-2 border-cyan-400" style="box-shadow: var(--brand-cyan-glow);">
                                <h3 class="text-2xl font-bold mb-4 text-cyan-400">Story Review</h3>
                                <div class="bg-gray-700 p-4 rounded mb-4">
                                    <h4 class="font-bold mb-2 text-yellow-400">Title: ${title}</h4>
                                    <div class="bg-gray-600 p-3 rounded">
                                        <p class="text-gray-200 whitespace-pre-wrap">${content}</p>
                                    </div>
                                </div>
                                <div class="flex justify-end space-x-4">
                                    <button onclick="this.closest('.fixed').remove()" class="bg-gray-600 hover:bg-gray-500 px-4 py-2 rounded transition-all">Close</button>
                                    <button onclick="this.closest('.fixed').remove(); document.getElementById('continue-to-narration-btn').click();" class="bg-cyan-600 hover:bg-cyan-500 px-4 py-2 rounded transition-all">Continue to Narration</button>
                                </div>
                            </div>
                        `;
                        document.body.appendChild(modal);
                    } else {
                        alert('Please write some content to review.');
                    }
                });
            }

            // OpenAI API Configuration
            let openaiApiKey = localStorage.getItem('openai_api_key') || '';
            
            async function callOpenAI(prompt, maxTokens = 1000) {
                if (!openaiApiKey) {
                    alert('Please configure your OpenAI API key in the Config page first.');
                    document.querySelector('a[href="#config"]').click();
                    return null;
                }
                
                try {
                    const response = await fetch('https://api.openai.com/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${openaiApiKey}`
                        },
                        body: JSON.stringify({
                            model: 'gpt-4o-mini',
                            messages: [
                                {
                                    role: 'user',
                                    content: prompt
                                }
                            ],
                            max_tokens: maxTokens,
                            temperature: 0.7
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`OpenAI API error: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    return data.choices[0].message.content;
                } catch (error) {
                    console.error('OpenAI API Error:', error);
                    alert('Error connecting to OpenAI. Please check your API key and try again.');
                    return null;
                }
            }
            
            // AI Writing Tools functionality
            const aiTools = {
                'generate-ideas-btn': async function() {
                    const prompt = "Generate 5 creative writing ideas for a story. Include different genres and interesting plot hooks. Format as a numbered list.";
                    const ideas = await callOpenAI(prompt);
                    if (ideas && editor) {
                        editor.value += '\n\n--- STORY IDEAS ---\n' + ideas + '\n';
                        updateWordCount();
                    }
                },
                'create-outline-btn': async function() {
                    const currentText = editor ? editor.value : '';
                    const prompt = `Based on this text: "${currentText.substring(0, 500)}", create a detailed story outline with 5-10 chapters. Include chapter titles and brief descriptions.`;
                    const outline = await callOpenAI(prompt, 1500);
                    if (outline && editor) {
                        editor.value += '\n\n--- STORY OUTLINE ---\n' + outline + '\n';
                        updateWordCount();
                    }
                },
                'expand-text-btn': async function() {
                    const selectedText = editor.value.substring(editor.selectionStart, editor.selectionEnd);
                    const textToExpand = selectedText || editor.value.split('\n').pop();
                    
                    if (!textToExpand.trim()) {
                        alert('Please select text or write something to expand.');
                        return;
                    }
                    
                    const prompt = `Expand and enhance this text with more detail, dialogue, and description: "${textToExpand}"`;
                    const expanded = await callOpenAI(prompt);
                    if (expanded) {
                        if (selectedText) {
                            // Replace selected text
                            const start = editor.selectionStart;
                            const end = editor.selectionEnd;
                            editor.value = editor.value.substring(0, start) + expanded + editor.value.substring(end);
                        } else {
                            editor.value += '\n\n' + expanded;
                        }
                        updateWordCount();
                    }
                },
                'summarize-btn': async function() {
                    const currentText = editor ? editor.value : '';
                    if (!currentText.trim()) {
                        alert('Please write some content to summarize.');
                        return;
                    }
                    
                    const prompt = `Summarize this text into key points: "${currentText}"`;
                    const summary = await callOpenAI(prompt);
                    if (summary) {
                        editor.value += '\n\n--- SUMMARY ---\n' + summary + '\n';
                        updateWordCount();
                    }
                },
                'rewrite-btn': async function() {
                    const selectedText = editor.value.substring(editor.selectionStart, editor.selectionEnd);
                    const textToRewrite = selectedText || editor.value;
                    
                    if (!textToRewrite.trim()) {
                        alert('Please select text or write something to rewrite.');
                        return;
                    }
                    
                    const prompt = `Rewrite this text to improve clarity, flow, and engagement: "${textToRewrite}"`;
                    const rewritten = await callOpenAI(prompt);
                    if (rewritten) {
                        if (selectedText) {
                            // Replace selected text
                            const start = editor.selectionStart;
                            const end = editor.selectionEnd;
                            editor.value = editor.value.substring(0, start) + rewritten + editor.value.substring(end);
                        } else {
                            editor.value = rewritten;
                        }
                        updateWordCount();
                    }
                },
                'character-builder-btn': async function() {
                    const prompt = "Create a detailed character profile for a story character. Include name, background, personality traits, motivations, and physical description.";
                    const character = await callOpenAI(prompt);
                    if (character && editor) {
                        editor.value += '\n\n--- CHARACTER PROFILE ---\n' + character + '\n';
                        updateWordCount();
                    }
                }
            };

            // Setup AI tool buttons
            Object.keys(aiTools).forEach(buttonId => {
                const btn = document.getElementById(buttonId);
                if (btn) {
                    btn.addEventListener('click', function() {
                        aiTools[buttonId]();
                    });
                }
            });

            // Chapter form submission with AI generation
            const chapterForm = document.getElementById('chapter-form');
            if (chapterForm) {
                chapterForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    const formData = {
                        title: document.getElementById('book-title').value,
                        author: document.getElementById('author-name').value,
                        genre: document.getElementById('genre').value,
                        chapters: document.getElementById('chapter-count').value,
                        tone: document.getElementById('tone-voice').value,
                        audience: document.getElementById('target-audience').value,
                        wordsPerChapter: document.getElementById('words-per-chapter').value,
                        description: document.getElementById('book-description').value
                    };
                    
                    if (!formData.title || !formData.author || !formData.description) {
                        alert('Please fill in all required fields (Title, Author, Description).');
                        return;
                    }
                    
                    const createBtn = document.getElementById('create-chapter-btn');
                    createBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Generating with AI...';
                    createBtn.disabled = true;
                    
                    try {
                        // Generate AI chapter plan
                        const chapterCount = parseInt(formData.chapters) || 5;
                        const prompt = `Create a detailed chapter plan for a book titled "${formData.title}" by ${formData.author}. 
                        
Book Description: ${formData.description}
Genre: ${formData.genre}
Tone: ${formData.tone}
Target Audience: ${formData.audience}
Number of Chapters: ${chapterCount}
Words per Chapter: ${formData.wordsPerChapter}

Generate ${chapterCount} chapter outlines. For each chapter, provide:
1. Chapter title
2. Brief summary (2-3 sentences)
3. Key plot points

Format each chapter as:
Chapter X: [Title]
Summary: [Summary]
---`;

                        const aiChapterPlan = await callOpenAI(prompt, 2000);
                        
                        if (aiChapterPlan) {
                            const planningSection = document.getElementById('chapter-planning');
                            const outlineContainer = document.getElementById('chapter-outlines');
                            
                            // Parse AI response and create editable chapters
                            const chapters = parseChapterPlan(aiChapterPlan, chapterCount);
                            let chaptersHTML = '';
                            
                            chapters.forEach((chapter, i) => {
                                chaptersHTML += `
                                    <div class="bg-gray-700 p-6 rounded-lg border border-gray-600 mb-4">
                                        <div class="mb-4">
                                            <label class="block text-sm font-medium text-cyan-400 mb-2">Chapter ${i + 1} Title</label>
                                            <input type="text" value="${chapter.title}" class="form-field-glow w-full rounded px-3 py-2">
                                        </div>
                                        <div class="mb-4">
                                            <label class="block text-sm font-medium text-cyan-400 mb-2">Chapter Outline</label>
                                            <textarea class="form-field-glow w-full rounded px-3 py-2 h-24 resize-none">${chapter.summary}</textarea>
                                        </div>
                                        <button onclick="generateChapterContent(${i + 1})" class="bg-purple-600 hover:bg-purple-500 text-white px-4 py-2 rounded transition-all">
                                            <i class="fas fa-magic mr-1"></i>Generate Chapter ${i + 1} Story
                                        </button>
                                    </div>
                                `;
                            });
                            
                            outlineContainer.innerHTML = chaptersHTML;
                            planningSection.style.display = 'block';
                            planningSection.scrollIntoView({ behavior: 'smooth' });
                        }
                    } catch (error) {
                        console.error('Chapter generation error:', error);
                        alert('Failed to generate chapter plan. Please check your API key.');
                    } finally {
                        createBtn.innerHTML = '<i class="fas fa-plus mr-2"></i>Create Chapter Plan';
                        createBtn.disabled = false;
                    }
                });
            }
            
            // Parse AI chapter plan response
            function parseChapterPlan(aiResponse, expectedChapters) {
                const chapters = [];
                const lines = aiResponse.split('\n');
                let currentChapter = { title: '', summary: '' };
                
                for (let line of lines) {
                    if (line.includes('Chapter') && line.includes(':')) {
                        if (currentChapter.title) {
                            chapters.push({ ...currentChapter });
                        }
                        currentChapter = {
                            title: line.replace(/Chapter \d+:\s*/, '').trim(),
                            summary: ''
                        };
                    } else if (line.includes('Summary:')) {
                        currentChapter.summary = line.replace('Summary:', '').trim();
                    } else if (line.trim() && currentChapter.title && !currentChapter.summary) {
                        currentChapter.summary = line.trim();
                    }
                }
                
                if (currentChapter.title) {
                    chapters.push(currentChapter);
                }
                
                // Ensure we have the expected number of chapters
                while (chapters.length < expectedChapters) {
                    chapters.push({
                        title: `Chapter ${chapters.length + 1}`,
                        summary: 'Chapter summary to be developed...'
                    });
                }
                
                return chapters.slice(0, expectedChapters);
            }
            
            // Generate individual chapter content
            window.generateChapterContent = async function(chapterNumber) {
                const chapterDiv = event.target.closest('.bg-gray-700');
                const title = chapterDiv.querySelector('input').value;
                const outline = chapterDiv.querySelector('textarea').value;
                
                const btn = event.target;
                btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-1"></i>Generating...';
                btn.disabled = true;
                
                try {
                    const prompt = `Write a complete chapter based on this information:
Chapter Title: ${title}
Chapter Outline: ${outline}

Write a full chapter story (approximately 1000-1500 words) with:
- Engaging narrative
- Dialogue
- Descriptive scenes
- Character development
- Proper story flow

Make it professional and engaging for readers.`;

                    const chapterContent = await callOpenAI(prompt, 2000);
                    
                    if (chapterContent) {
                        // Switch to workspace and add content
                        document.querySelector('a[href="#workspace"]').click();
                        
                        setTimeout(() => {
                            const editor = document.getElementById('manuscript-editor');
                            const chapterTitle = document.getElementById('chapter-title');
                            
                            if (chapterTitle) chapterTitle.value = title;
                            if (editor) {
                                editor.value = chapterContent;
                                updateWordCount();
                            }
                        }, 100);
                    }
                } catch (error) {
                    alert('Failed to generate chapter content. Please try again.');
                } finally {
                    btn.innerHTML = `<i class="fas fa-magic mr-1"></i>Generate Chapter ${chapterNumber} Story`;
                    btn.disabled = false;
                }
            };

            // Cover generation
            const generateCoverBtn = document.getElementById('generate-cover-btn');
            if (generateCoverBtn) {
                generateCoverBtn.addEventListener('click', function() {
                    const originalText = this.innerHTML;
                    this.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Generating with DALL-E 3...';
                    this.disabled = true;
                    
                    setTimeout(() => {
                        alert('DALL-E 3 HD Cover Generation (1024x1792) will create professional book covers based on your specifications.');
                        this.innerHTML = originalText;
                        this.disabled = false;
                    }, 3000);
                });
            }

            // Load saved content
            const savedContent = localStorage.getItem('authorr_manuscript');
            const savedTitle = localStorage.getItem('authorr_chapter_title');
            
            if (savedContent && editor) {
                editor.value = savedContent;
                updateWordCount();
            }
            if (savedTitle && document.getElementById('chapter-title')) {
                document.getElementById('chapter-title').value = savedTitle;
            }

            // Auto-save every 30 seconds
            if (editor) {
                setInterval(() => {
                    if (editor.value.trim()) {
                        saveToHistory(editor.value);
                    }
                }, 30000);
            }
            
            // Config page functionality
            const saveConfigBtn = document.getElementById('save-config-btn');
            const testApiBtn = document.getElementById('test-api-btn');
            const apiKeyInput = document.getElementById('api-key-input');
            
            // Load saved API key
            if (apiKeyInput && openaiApiKey) {
                apiKeyInput.value = openaiApiKey;
            }
            
            if (saveConfigBtn) {
                saveConfigBtn.addEventListener('click', function() {
                    const apiKey = apiKeyInput ? apiKeyInput.value.trim() : '';
                    
                    if (apiKey) {
                        localStorage.setItem('openai_api_key', apiKey);
                        openaiApiKey = apiKey;
                        
                        this.innerHTML = '<i class="fas fa-check mr-2"></i>Configuration Saved!';
                        setTimeout(() => {
                            this.innerHTML = '<i class="fas fa-save mr-2"></i>Save Configuration';
                        }, 2000);
                    } else {
                        alert('Please enter a valid OpenAI API key.');
                    }
                });
            }
            
            if (testApiBtn) {
                testApiBtn.addEventListener('click', async function() {
                    const apiKey = apiKeyInput ? apiKeyInput.value.trim() : openaiApiKey;
                    
                    if (!apiKey) {
                        alert('Please enter an API key first.');
                        return;
                    }
                    
                    this.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Testing...';
                    this.disabled = true;
                    
                    try {
                        const response = await fetch('https://api.openai.com/v1/chat/completions', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${apiKey}`
                            },
                            body: JSON.stringify({
                                model: 'gpt-4o-mini',
                                messages: [{ role: 'user', content: 'Say "API connection successful!"' }],
                                max_tokens: 10
                            })
                        });
                        
                        if (response.ok) {
                            this.innerHTML = '<i class="fas fa-check mr-2"></i>API Connected!';
                            this.className = 'bg-green-600 hover:bg-green-500 text-white px-8 py-3 rounded-lg font-semibold transition-all ml-4';
                            
                            // Save the working key
                            localStorage.setItem('openai_api_key', apiKey);
                            openaiApiKey = apiKey;
                        } else {
                            throw new Error(`HTTP ${response.status}`);
                        }
                    } catch (error) {
                        this.innerHTML = '<i class="fas fa-times mr-2"></i>Connection Failed';
                        this.className = 'bg-red-600 hover:bg-red-500 text-white px-8 py-3 rounded-lg font-semibold transition-all ml-4';
                        alert('API connection failed. Please check your API key.');
                    } finally {
                        this.disabled = false;
                        setTimeout(() => {
                            this.innerHTML = '<i class="fas fa-check mr-2"></i>Test API Connection';
                            this.className = 'bg-green-600 hover:bg-green-500 text-white px-8 py-3 rounded-lg font-semibold transition-all ml-4';
                        }, 3000);
                    }
                });
            }
        });
    </script>
</body>
</html>